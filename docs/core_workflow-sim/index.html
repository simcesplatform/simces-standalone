<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://simcesplatform.github.io/core_workflow-sim/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Workflow of component in simulation - SimCES</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../css/extra.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">SimCES</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Use <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href=".." class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../core_features/" class="dropdown-item">Features</a>
</li>
                                    
<li>
    <a href="../core_install/" class="dropdown-item">Installation</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Run simulation</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../core_run/" class="dropdown-item">Overview</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Test platform</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../core_run-first/" class="dropdown-item">Run first test simulation</a>
</li>
            
<li>
    <a href="../energy_run-ec-demo/" class="dropdown-item">Run Energy Community demo</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../core_platform-settings/" class="dropdown-item">Configuring settings</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Start simulation</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../core_run-preparations/" class="dropdown-item">Simulation run preparations</a>
</li>
            
<li>
    <a href="../core_start-simulation/" class="dropdown-item">Starting a simulation</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../core_follow-run/" class="dropdown-item">Follow running simulation</a>
</li>
            
<li>
    <a href="../core_stop-simulation/" class="dropdown-item">Stop simulation</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="../core_log-api/" class="dropdown-item">Log API</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Develop <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../core_develop-overview/" class="dropdown-item">Overview</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Basic concepts</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../core_time/" class="dropdown-item">Time and synchronization with epochs</a>
</li>
            
<li>
    <a href="../core_cmp-mgmt/" class="dropdown-item">Platform managed and externally managed components</a>
</li>
            
<li>
    <a href="../core_soa/" class="dropdown-item">Service-oriented architecture</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">How to develop</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Creating new component</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../core_create-cmp/" class="dropdown-item">Overview</a>
</li>
            
<li>
    <a href="../core_docker-image/" class="dropdown-item">Building Docker image for a component</a>
</li>
            
<li>
    <a href="../core_component-manifest/" class="dropdown-item">Creating a component manifest file</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../core_conv-msg/" class="dropdown-item">Conventions of messaging</a>
</li>
            
<li>
    <a href="../core_conv-name/" class="dropdown-item">Conventions of naming</a>
</li>
            
<li>
    <a href="../core_pseudocode/" class="dropdown-item">Pseudocode reference</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Simulation Tools package</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../core_sim-tools/" class="dropdown-item">Simulation Tools package</a>
</li>
            
<li>
    <a href="../core_abstractsimulationcomponent/" class="dropdown-item">AbstractSimulationComponent</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="./" class="dropdown-item active">Workflow of component in simulation</a>
</li>
            
<li>
    <a href="../core_workflow-start-end/" class="dropdown-item">Workflow of start and end</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Communication</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../core_topics-queues-exchanges/" class="dropdown-item">Topics, queues and exchanges</a>
</li>
            
<li>
    <a href="../core_exchange-mgmt/" class="dropdown-item">Exchange, management</a>
</li>
            
<li>
    <a href="../core_exchange-sim/" class="dropdown-item">Exchange, simulation-specific</a>
</li>
            
<li>
    <a href="../core_topics/" class="dropdown-item">Topics (core)</a>
</li>
            
<li>
    <a href="../core_rabbitmq-reliability/" class="dropdown-item">Reliable messaging in RabbitMQ</a>
</li>
            
<li>
    <a href="../core_amqp-footprint/" class="dropdown-item">Footprint of AMQP items</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Message structures (core)</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../core_msg/" class="dropdown-item">Message structures (core)</a>
</li>
            
<li>
    <a href="../core_msgtype/" class="dropdown-item">Message type names (core)</a>
</li>
            
<li>
    <a href="../core_ucum/" class="dropdown-item">Units of measure (UCUM)</a>
</li>
            
<li>
    <a href="../core_msg-abstractmessage/" class="dropdown-item">Message - AbstractMessage</a>
</li>
            
<li>
    <a href="../core_msg-abstractresult/" class="dropdown-item">Message - AbstractResult</a>
</li>
            
<li>
    <a href="../core_msg-epoch/" class="dropdown-item">Message - Epoch</a>
</li>
            
<li>
    <a href="../core_msg-simstate/" class="dropdown-item">Message - SimState</a>
</li>
            
<li>
    <a href="../core_msg-start/" class="dropdown-item">Message - Start</a>
</li>
            
<li>
    <a href="../core_msg-status/" class="dropdown-item">Message - Status</a>
</li>
            
<li>
    <a href="../core_block-quantity/" class="dropdown-item">Block - Quantity</a>
</li>
            
<li>
    <a href="../core_block-quantity-array/" class="dropdown-item">Block - Quantity array</a>
</li>
            
<li>
    <a href="../core_block-time-series/" class="dropdown-item">Block - Time series</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Platforms internals</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../core_logging-system/" class="dropdown-item">Logging system</a>
</li>
            
<li>
    <a href="../core_logwriter/" class="dropdown-item">LogWriter</a>
</li>
            
<li>
    <a href="../core_platformmanager/" class="dropdown-item">Platform Manager</a>
</li>
            
<li>
    <a href="../core_lifecycle/" class="dropdown-item">Simulation lifecycle</a>
</li>
            
<li>
    <a href="../core_simulationmanager/" class="dropdown-item">Simulation Manager</a>
</li>
            
<li>
    <a href="../core_dummycomponent/" class="dropdown-item">Dummy Component</a>
</li>
            
<li>
    <a href="../core_amqpmathtool/" class="dropdown-item">AmqpMathToolIntegration</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Energy domain <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../energy_overview/" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../energy_conventions/" class="dropdown-item">Energy-domain-specific conventions</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Components (energy)</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../energy_controller/" class="dropdown-item">Controller</a>
</li>
            
<li>
    <a href="../energy_distribution-management-system-dms/" class="dropdown-item">Distribution management system (DMS)</a>
</li>
            
<li>
    <a href="../energy_grid-dss/" class="dropdown-item">Grid (DSS)</a>
</li>
            
<li>
    <a href="../energy_economicdispatch/" class="dropdown-item">Economic Dispatch</a>
</li>
            
<li>
    <a href="../energy_priceforecaster/" class="dropdown-item">Price Forecaster</a>
</li>
            
<li>
    <a href="../energy_procem-lfm/" class="dropdown-item">Procem-LFM</a>
</li>
            
<li>
    <a href="../energy_resourceforecaster/" class="dropdown-item">Resource Forecaster</a>
</li>
            
<li>
    <a href="../energy_static-time-series-resource/" class="dropdown-item">Static time series resource</a>
</li>
            
<li>
    <a href="../energy_storage/" class="dropdown-item">Storage</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Message structures (energy)</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../energy_msg-controlstate-powersetpoint/" class="dropdown-item">ControlState.PowerSetpoint</a>
</li>
            
<li>
    <a href="../energy_msg-dmsnetworkstatus-current/" class="dropdown-item">DMSNetworkStatus.Current</a>
</li>
            
<li>
    <a href="../energy_msg-dmsnetworkstatus-voltage/" class="dropdown-item">DMSNetworkStatus.Voltage</a>
</li>
            
<li>
    <a href="../energy_msg-flexibilityneed/" class="dropdown-item">FlexibilityNeed</a>
</li>
            
<li>
    <a href="../energy_msg-init-cis-customerinfo/" class="dropdown-item">Init.CIS.CustomerInfo</a>
</li>
            
<li>
    <a href="../energy_msg-init-nis-networkbusinfo/" class="dropdown-item">Init.NIS.NetworkBusInfo</a>
</li>
            
<li>
    <a href="../energy_msg-init-nis-networkcomponentinfo/" class="dropdown-item">Init.NIS.NetworkComponentInfo</a>
</li>
            
<li>
    <a href="../energy_msg-lfmmarketresult/" class="dropdown-item">LFMMarketResult</a>
</li>
            
<li>
    <a href="../energy_msg-lfmoffering/" class="dropdown-item">LFMOffering</a>
</li>
            
<li>
    <a href="../energy_msg-networkforecaststate-current/" class="dropdown-item">NetworkForecastState.Current</a>
</li>
            
<li>
    <a href="../energy_msg-networkforecaststate-voltage/" class="dropdown-item">NetworkForecastState.Voltage</a>
</li>
            
<li>
    <a href="../energy_msg-networkstate-current/" class="dropdown-item">NetworkState.Current</a>
</li>
            
<li>
    <a href="../energy_msg-networkstate-loss/" class="dropdown-item">NetworkState.Loss</a>
</li>
            
<li>
    <a href="../energy_msg-networkstate-voltage/" class="dropdown-item">NetworkState.Voltage</a>
</li>
            
<li>
    <a href="../energy_msg-offer/" class="dropdown-item">Offer</a>
</li>
            
<li>
    <a href="../energy_msg-priceforecaststate/" class="dropdown-item">PriceForecastState</a>
</li>
            
<li>
    <a href="../energy_msg-request/" class="dropdown-item">Request</a>
</li>
            
<li>
    <a href="../energy_msg-resourceforecaststate-dispatch/" class="dropdown-item">ResourceForecastState.Dispatch</a>
</li>
            
<li>
    <a href="../energy_msg-resourceforecaststate-power/" class="dropdown-item">ResourceForecastState.Power</a>
</li>
            
<li>
    <a href="../energy_msg-resourcestate/" class="dropdown-item">ResourceState</a>
</li>
            
<li>
    <a href="../energy_msg-selectedoffer/" class="dropdown-item">SelectedOffer</a>
</li>
            
<li>
    <a href="../energy_msg-startmessageblocks/" class="dropdown-item">Start message blocks</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="../energy_msgtype/" class="dropdown-item">Message type names (energy)</a>
</li>
                                    
<li>
    <a href="../energy_software-pkg/" class="dropdown-item">Software packages</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Topics (energy)</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../energy_topics/" class="dropdown-item">Topics (energy)</a>
</li>
            
<li>
    <a href="../energy_topic-priceforecaststate/" class="dropdown-item">PriceForecastState.(MarketId).(ResourceId)</a>
</li>
            
<li>
    <a href="../energy_topic-resourceforecaststate/" class="dropdown-item">ResourceForecastState.(ResourceCategory).(ResourceId)</a>
</li>
            
<li>
    <a href="../energy_topic-resourcestate/" class="dropdown-item">ResourceState.(ResourceCategory).(ResourceId)</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Scenarios</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../energy_scenario-ec-demo/" class="dropdown-item">Energy community demo</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">About... <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../about/" class="dropdown-item">About...</a>
</li>
                                    
<li>
    <a href="../license/" class="dropdown-item">License</a>
</li>
                                    
<li>
    <a href="../maintenance-plan/" class="dropdown-item">Maintenance plan</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../core_abstractsimulationcomponent/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../core_workflow-start-end/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#workflow-of-component-in-simulation" class="nav-link">Workflow of component in simulation</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#how-to-read-this-page" class="nav-link">How to read this page</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#handling-simulation-state-and-epochs" class="nav-link">Handling simulation state and epochs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#initialization-workflow" class="nav-link">Initialization workflow</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#calculation-workflow" class="nav-link">Calculation workflow</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#iterative-calculation-during-epoch" class="nav-link">Iterative calculation during epoch</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#error-handling" class="nav-link">Error handling</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#warnings" class="nav-link">Warnings</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#logging" class="nav-link">Logging</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="workflow-of-component-in-simulation">Workflow of component in simulation</h1>
<p>This page explains the workflow a component is expected to follow during a simulation run, excluding the start and end of a simulation run.</p>
<h2 id="how-to-read-this-page">How to read this page</h2>
<p>Some sections in this page use pseudocode. For reference, see <a href="../core_pseudocode/">Pseudocode reference</a>.</p>
<p>Each pseudocode block is explained in text. The pseudocode is always the primary specification. That is, if the pseudocode conflicts with the text, the pseudocode has preference because the text is merely elaborative.</p>
<p>The following apply in all pseudocode blocks of this page.</p>
<table>
<thead>
<tr>
<th>Item in pseudocode</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>publ error</td>
<td>Publish a Status message that indicates an error to "Status.Error"</td>
</tr>
<tr>
<td>publ ready</td>
<td>Publish a Status message that indicates readiness to "Status.Ready" topic</td>
</tr>
<tr>
<td>recv epoch</td>
<td>From "Epoch" topic, receive an Epoch message</td>
</tr>
<tr>
<td>recv input</td>
<td>Receive input for calculation. This does not specify the topic the input comes from.</td>
</tr>
<tr>
<td>recv running</td>
<td>From "SimState" topic, receive a SimState message with state "running"</td>
</tr>
<tr>
<td>recv stop</td>
<td>From "SimState" topic, receive a SimState message with state "stopped"</td>
</tr>
</tbody>
</table>
<h2 id="handling-simulation-state-and-epochs">Handling simulation state and epochs</h2>
<pre><code class="language-nohighlight">recv running
publ ready

first_epoch = true

loop

  wait for one of
    recv stop
      quit
    recv epoch

  // Include this if block only when implementing an initialization workflow
  if first_epoch

    first_epoch = false // Reach this block only once

    // Run initialization workflow
    run_initialization_workflow()

  // Run calculation workflow
  run_calculation_workflow()
</code></pre>
<p>The workflow start with the reception of the state message "running". Then, the component announces it is ready to start by publishing "ready".</p>
<p>Once all components have announced they are ready, the platform starts the actual epochs of simulation. In each epoch, the component first awaits an epoch message. However, if the platform instructs the component to stop during this wait, the component will quit.</p>
<p>In epoch 1, the component MAY start with an initialization workflow. This means that the component communicates some parameters with other components.</p>
<p>Regardless if an initialization workflow took place or not, the component continues to the calculation workflow.</p>
<p>Next, the component awaits another epoch to begin.</p>
<h2 id="initialization-workflow">Initialization workflow</h2>
<p>Initialization workflow is an OPTIONAL step in epoch 1. In this workflow, the component communicates some information with other components before starting the calculation workflow. The component developer decides the following about the initialization workflow depending on the needs:</p>
<ul>
<li>What information is communicated</li>
<li>How many components are involved</li>
<li>Which messages are published</li>
<li>Which components receive the published messages</li>
<li>Whether each component should only receive, only publish or both receive and publish messages</li>
<li>
<p>If the component implements an initialization workflow, this:</p>
</li>
<li>
<p>MUST occur in epoch 1</p>
</li>
<li>MUST occur exactly once in each simulation run</li>
<li>MUST occur as the first task the component accomplishes in the epoch</li>
</ul>
<h3 id="topic-names">Topic names</h3>
<p>Any topic name involved in the initialization workflow MUST start with "Init.".</p>
<p>To prevent confusion in the processing of messages, a topic name involved in the calculation workflow of any component MUST NOT be involved in the initialization workflow of any component.</p>
<h3 id="publish">Publish</h3>
<p>In this example, the component publishes a message in the initialization workflow. This is appropriate if the component has some information the other components need.</p>
<pre><code class="language-nohighlight">function run_initialization_workflow()

  publish init_info to topic &quot;Init.Xyz&quot;
</code></pre>
<h3 id="receive">Receive</h3>
<p>In this example, the component receives a message in the initialization workflow. This is appropriate if the component needs some information from another component.</p>
<pre><code class="language-nohighlight">function run_initialization_workflow()

  recv init_info from topic &quot;Init.Xyz&quot;
</code></pre>
<h2 id="calculation-workflow">Calculation workflow</h2>
<p>This section describes the rules of interaction for components within one epoch. Although the word "calculation" appears in the title, the component does not necessarily calculate anything. If appropriate, the component may as well supply predefined values from a time series, for instance.</p>
<p>The calculation workflow takes place after each reception of an epoch message. That is, this excludes the reception of the epoch message!</p>
<h3 id="required-items">REQUIRED items</h3>
<pre><code class="language-nohighlight">function run_calculation_workflow()

  // 1. Calculate whatever you want. Communicate with other components as needed.
  // ...

  // 2. Report readiness
  publ ready
</code></pre>
<p>When a component has finished its operation in the epoch, it MUST send a ready message. This is the sole requirement set by the platform. A particular simulation scenario CAN set further requirements to enable the components to interact, but these are beyond the core functionality of the platform.</p>
<h3 id="send-in-every-epoch">Send in Every Epoch</h3>
<p>A component MAY publish results (i.e., output data) as the developers consider appropriate, but there is a rule called "Send in Every Epoch" (SIEE). This means that the component SHOULD be predictable in its publishing behaviour.</p>
<p>For example, let component C have the capability to publish a result of type R. If C publishes an R in any epoch, it SHOULD publish an R in all epochs during the simulation run. The motivation is that the other components may not know when to expect R and when not. Therefore, it is most straightforward to always publish an R.</p>
<p>Depending on the simulation scenario, the data enclosed in R can remain unchanged between certain epochs. For instance, if the resolution of a timeseries is 60 minutes and epoch length 15 minutes, a change will occur only in every fourth epoch. To follow the SIEE rule, C would re-send the same result data again when no changes have occurred. To help other components in saving resources and possibly avoid redundant calculation, C SHOULD assign the value of the field "LastUpdatedInEpoch" to indicate when the most recent change has occurred (see <a href="../core_msg-abstractresult/">AbstractResult</a>). Still, C MUST update the other metadata as specified in page <a href="../core_msg-abstractresult/">AbstractResult</a>.</p>
<h3 id="without-input-data">Without input data</h3>
<p>This is an OPTIONAL workflow. It is applicable when no input data is needed for calculation.</p>
<pre><code class="language-nohighlight">function run_calculation_workflow()

  calc result
  publ result
  publ ready
</code></pre>
<p>The component calculates a result and publishes this. What is calculated and how and to which topic it is published depends on the component. Finally, the component reports readiness.</p>
<h3 id="with-input-data">With input data</h3>
<p>This is an OPTIONAL workflow. It is applicable when input data is necessary for calculation.</p>
<pre><code class="language-nohighlight">function run_calculation_workflow()

  wait for one of
    recv stop
      quit
    recv input

  calc result
  publ result
  publ ready
</code></pre>
<p>Before calculation, the component waits for input data. If it the platform instruct the component to stop while waiting, the execution will end. After receiving the data, to component calculates and publishes a result. What this result is and to which topic it is published depends on the component.</p>
<h2 id="iterative-calculation-during-epoch">Iterative calculation during epoch</h2>
<h3 id="basic-rules">Basic rules</h3>
<p>When components run an iterative algorithm during an epoch, the related functionality must be designed carefully.</p>
<p>Iteration MUST NOT be infinite, because this would cause the simulation to get stuck. Therefore, iteration MUST be designed in one of the following ways:</p>
<ul>
<li>(a) There is a guarantee that the algorithm always converges eventually</li>
<li>(b) If convergence cannot be guaranteed, the component MUST use another mechanism to end iteration when convergence does not occur</li>
</ul>
<p>Alternative (b) MAY require that the iterating component still publishes a reasonable result. This result MAY be:</p>
<ul>
<li>(h) A default value</li>
<li>(i) A value calculated with a simpler algorithm</li>
<li>(j) Anything else considered appropriate</li>
</ul>
<p>The way to guarantee a reasonable result is case-specific and therefore out of scope of the core platform. This means that the component developers MUST recognize this need on their own and design an appropriate mechanism.</p>
<h3 id="multi-component-iteration">Multi-component iteration</h3>
<h4 id="multi-component-schemes">Multi-component schemes</h4>
<p>Iteration MAY include multiple components. This means that one or more components form one or more groups where the components both produce input data to one another and consume the result data of one another.</p>
<p>When multi-component iteration occurs, the component developers MUST take care that the iteration ends eventually. To ensure this, the component developers MUST assign each iterating component a role of either active or passive iterator:</p>
<ul>
<li><em>Active iterators</em>. Each iteration group MUST include at least one active iterator component that has the ability to decide when to end iteration.</li>
<li><em>Passive iterators</em>. In a group of iterators, all components that are not active iterators are passive. These do not actively decide when to end iteration but know that they are involved in iteration. Passive iterators MUST understand the decision of an active iterator to end.</li>
</ul>
<p>The following figure illustrates a few of the potential iteration schemes. In the figure, each arrow represents how each component supplies results that are the input data of another component. The schemes include:</p>
<ul>
<li>(A) A cycle of two components, one active and one passive</li>
<li>(B) A cycle of three components, one active and two passive</li>
<li>(C) A cycle of three components, two active and one passive<ul>
<li>If any active iterator decides to end iteration, the result messages will deliver this information to all</li>
</ul>
</li>
<li>(D) Two iteration cycles both of which have X as the active iterator; these cycles may operate independently if wanted</li>
</ul>
<p>Still, the scheme MAY be even more complex, that is, contain more components and more cycles.</p>
<p><img alt="Iteration illustrated" src="../images/iteration.png" /></p>
<h4 id="messaging-in-iteration">Messaging in iteration</h4>
<p>In a multi-component iteration scheme, all iterating components MUST communicate the status of iteration in each result message. The component MUST indicate this in two ways:</p>
<ul>
<li>(1) Using the field "IterationStatus" (see <a href="../core_msg-abstractmessage/">AbstractMessage</a>) <strong>and</strong></li>
<li>(2) Using the suffix ".Iter" in topic name when the result is intermediate and omitting this suffix when the result is final<ul>
<li>Please see the naming conventions in page <a href="../core_conv-name/">Conventions of naming</a></li>
</ul>
</li>
</ul>
<p>Together, conditions (1) and (2) ensure a uniform way to communicate which of the messages represent intermediate results and which are final. This has at least the following uses:</p>
<ul>
<li>During a simulation, enable a component to receive only final results when it does not participate in iteration</li>
<li>After simulation, enable the separation of intermediate and final results in the retrieval of logged data</li>
</ul>
<p>The following tables tells how active and passive iterators decide whether to continue iteration. An active iterator continues iteration as long as it wants and no other iterator has declared its output as "final". In contrast, a passive iterator never decides when to end but instead re-uses the iteration status it has received in input.</p>
<p>Active iterator:</p>
<table>
<thead>
<tr>
<th>Does the iterator want to iterate still?</th>
<th>IterationStatus received in input data</th>
<th>IterationStatus to assign to result message</th>
</tr>
</thead>
<tbody>
<tr>
<td>Yes</td>
<td>Intermediate</td>
<td>Intermediate (iteration continues)</td>
</tr>
<tr>
<td>Yes</td>
<td>Final</td>
<td>Final (iteration ends)</td>
</tr>
<tr>
<td>No</td>
<td>Intermediate</td>
<td>Final (iteration ends)</td>
</tr>
<tr>
<td>No</td>
<td>Final</td>
<td>Final (iteration ends)</td>
</tr>
</tbody>
</table>
<p>Passive iterator:</p>
<table>
<thead>
<tr>
<th>IterationStatus received in input data</th>
<th>IterationStatus to assign to result message</th>
</tr>
</thead>
<tbody>
<tr>
<td>Intermediate</td>
<td>Intermediate (iteration continues)</td>
</tr>
<tr>
<td>Final</td>
<td>Final (iteration ends)</td>
</tr>
</tbody>
</table>
<h4 id="active-iterator-workflow">Active iterator workflow</h4>
<p>The following code shows the basic workflow that an active iterator MAY implement for epochs. This assumes that the iterator receives exactly one result message as the input.</p>
<pre><code class="language-nohighlight">topic = &quot;TopicX&quot; // Just an example

loop // Loop to enable iteration

  wait for one of
    recv stop
      quit
    input = recv input

  iter_status = decide my iter status
  topic_temp = topic

  // Iter status is final if this iterator wants it or
  // if the input data is final
  if input.iter_status is final
    iter_status = final

  if iter_status is not final
    topic_temp = topic_temp + &quot;.Iter&quot;

  result = calc result
  result.iter_status = iter_status
  publ result to topic_temp

  if iter_status is final
    publ ready
    break loop
</code></pre>
<h4 id="passive-iterator-workflow">Passive iterator workflow</h4>
<p>The following code shows the basic workflow that a passive iterator MAY implement for epochs. This assumes that the iterator receives exactly one result message as the input.</p>
<pre><code class="language-nohighlight">topic = &quot;TopicY&quot; // Just an example

loop // Loop to enable iteration

  wait for one of
    recv stop
      quit
    input = recv input

  topic_temp = topic

  if input.iter_status is not final
    topic_temp = topic_temp + &quot;.Iter&quot;

  calc result
  result.iter_status = input.iter_status
  publ result to topic_temp

  if input.iter_status is final
    publ ready
    break loop
</code></pre>
<h2 id="error-handling">Error handling</h2>
<p>Error is a condition that the component cannot recover from. This happens when, e.g., the component receives a message it should use in calculation but the message is malformed or when there is a bug in the component that prevents further execution.</p>
<p>Each component SHOULD be designed to detect errors. Fortunately, modern software languages have mechanisms, such as exceptions, that enable straightforward error handling. Regardless of the mechanism, the component SHOULD be ready to encounter an error anywhere in the code. Such error handling facilitates the tracking of bugs, which inevitably occur in software. Carefully implemented error handling reduces the time required for development.</p>
<p>Not all errors can be communicated. For example, the network can be out of reach or the component can run out of memory. However, it is common that communication is still possible regardless of an error.</p>
<p>In case an error occurs in a component, the platform has been designed to work as follows:</p>
<ol>
<li>The component reports the error</li>
<li>The platform signals all components to stop and will publish no more epoch messages<ul>
<li>I.e., all components MUST quit</li>
<li>If another component is busy on calculation when the stop message arrives, it MAY continue to produce a result and publish this before quitting</li>
</ul>
</li>
</ol>
<p>The following explains how a component SHOULD behave when it has encountered an error. The component immediately publishes an error message (see section how to read). Now, the component waits for the platform to stop the simulation. However, if the component receives another message instead (likely the result of another component or an epoch message), it will re-publish the error message.</p>
<pre><code class="language-nohighlight">loop

  publ error

  wait for one of
    recv stop
      quit
    recv epoch
    recv input

  // From here, the execution will jump to start of loop
</code></pre>
<h2 id="warnings">Warnings</h2>
<p>A warning means that something is wrong in the logic of a process, but this can still produce something meaningful as the result. Possible causes for warnings include, for instance:</p>
<ul>
<li>Invalid or unrealistic input data</li>
<li>Failure to converge the calculation</li>
</ul>
<p>Warnings are informative but not fatal. Still, the presence of a warning in a message MAY cause a fatal condition in another process.</p>
<p>When a warning occurs, the process MAY, depending on the situation:</p>
<ul>
<li>Supply default values as the result</li>
<li>Execute a secondary calculation logic to have some result</li>
<li>Execute its primary calculation logic, although the result can be unreliable</li>
</ul>
<h3 id="how-to-indicate-warning">How to indicate warning</h3>
<p>When a component thinks a warning has occurred, it SHOULD indicate this in the result message. Please see <a href="../core_msg-abstractresult/">AbstractResult</a>.</p>
<h2 id="logging">Logging</h2>
<p>Each component SHOULD have an internal log to help in development and debugging. The reason is that it can be difficult to include all relevant information in the messages that indicate errors or warnings.</p>
<p>The log SHOULD contain at least:</p>
<ul>
<li>Error information (such as stack trace if the platform generates exceptions)</li>
<li>Warning information</li>
</ul>
<p>The log MAY contain:</p>
<ul>
<li>Entries about the execution of the component, such a steps of the internal workflow</li>
<li>Any other information considered relevant</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>SimCES | Simulation Environment of Complex Energy System</p>
                <p>Copyright &copy; 2021-2022 Tampere University and VTT Technical Research Centre of Finland</p>
            <p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a> [<a href="https://datatracker.ietf.org/doc/html/rfc2119">RFC2119</a>] [<a href="https://datatracker.ietf.org/doc/html/rfc8174">RFC8174</a>] when, and only when, they appear in all capitals, as shown here.</p>
            <p>Get source code from GitHub: <a href="https://github.com/simcesplatform">https://github.com/simcesplatform</a> (MIT license; see the source code or <a href="../license">license</a>)</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
